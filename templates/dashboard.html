{% extends 'base.html' %}
{% block title %}Панель управления{% endblock %}
{% load static %}
{% block content %}
{% load crispy_forms_tags %}
{% csrf_token %}
{% include 'nav.html' %}



            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid">
                        <h1 class="mt-4 mb-4">Мониторинг</h1>
                         <div class="row">
                            <div class="col-xl-8 mb-3">
                               {% load thumbnail %}
<!--                                {% thumbnail building.image "480x480" -->
<!--                                crop="center" upscale=True as im %}-->
                                {% thumbnail building.image "200x250" crop="center" upscale=True as im %}
                                    <div style="position: relative">


                               <img class="card-img" src="{{ building.image.url }}" />
                                        <div style="position: absolute;
                                        top:150px; left: 120px;
                                        font-size:40px">
                                            {{leaksensorvalues.0}}
                                        </div>
                                        <div style="position: absolute;
                                        top:150px; left: 450px;
                                        font-size:40px">
                                            {{leaksensorvalues.1}} </div>

                                        <div style="position: absolute;
                                        top:150px; left: 750px;
                                        font-size:40px">
                                            {{leaksensorvalues.2}} </div>
                                        <div style="position: absolute;
                                        top:400px; left: 120px;
                                        font-size:40px">
                                            {{leaksensorvalues.5}} </div>
                                        <div style="position: absolute;
                                        top:400px; left: 450px;
                                        font-size:40px">
                                            {{leaksensorvalues.4}} </div>
                                        <div style="position: absolute;
                                        top:400px; left: 750px;
                                        font-size:40px">
                                            {{leaksensorvalues.3}} </div>

                                    </div>
                                {% endthumbnail %}
                                </div>

                            </div>
                        </div>
                        <ol class="breadcrumb mb-4">


                        <div class="row">
                            <div class="col-xl-12 mb-3">
                                <p style="font-weight: bold">
                                    Данные
                                объекта
                                </p>
                                <p>
                                  Наименование объекта - "{{building}}"
                                </p>
                                <p>
                                  Адрес объекта -  {{building.adress}}<br>
                                    Координаты объекта
                                    {{building.coordinates_lat}}, {{building.coordinates_lon}}
                                </p>
                                <p>
                                    Номер телефона инженера по эксплуатации
                                    (для отправки смс-уведомлений)
                                    {{building.phone_number}}
                                    
                                </p>
                            </div>

                        </div>


                            </ol>
                             <ol class="breadcrumb mb-4">
                                 <div class="col-xl-12 mb-3">
<!--                                 <p>-->
<!--                                 Количетсво установленных датчиков - -->
<!--                                 {{building.sensor.all.count}} шт-->
<!--                                     </p>-->
<!--                                 <p>-->
                                     <i style="font-weight: bold">Датчики
                                         снега: </i>
                                     <br>
                                 {%for sensor in building.sensor.all %}
                                     {{sensor}}, количество показаний -
                                 {{sensor.sensorvalues.all.count}} <br>
                                 {% endfor %}

                                     <i style="font-weight: bold">Датчики
                                         Температуры: </i><br>
                                     {%for sensor in building.temperaturesensor.all %}
                                     {{sensor}}, количество показаний -
                                 {{sensor.temperaturesensorvalues.all.count}} <br>
                                 {% endfor %}

                                     <br>
                                 </p>
                                 </div>
                             </ol>



                        <form >
                            <p>
                                <label for="date">Архив показаний: </label>
                                <input type="date" id="date" name="date"/>
                                <button type="submit">Загрузить</button>
                            </p>

                        </form>

<!--                        <form method="post">-->
<!--                            {% csrf_token %}-->
<!--                            <input type="hidden" name="next" value="{{ next }}">-->
<!--                            {{ response_comand_form|crispy }}-->
<!--                            <button type="submit">Сохранить</button>-->
<!--                        </form>-->




                        <!-- First charts -->
                        <div class="row ">
                            <div class="col-xl-8">
                                <div class="card mb-5">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area mr-1"></i>
                                        Снеговая нагрузка, кг/м2
                                    </div>
                                    <canvas id="snow_sens"></canvas>
                                </div>
                            </div>


                        <!-- Second charts -->

                            <div class="col-xl-4">
                                <div class="row">
                                    <div class="col-xl-12">
                                        <div class="container">
                                            <div class="card mb-1">
                                                <div class="card-header">
                                                    <i class="fas fa-chart-area mr-1"></i>
                                                    Показания температуры (прогноз погоды)
                                                </div>
                                                <canvas id="temp_API"></canvas>
                                            </div>

                                            <div class="card mb-1">
                                                <div class="card-header">
                                                <i class="fas fa-chart-area mr-1"></i>
                                                Показания снега (прогноз погоды)
                                                </div>
                                                <canvas id="snow_API"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>





                    </div>
                </main>
                <footer class="py-4 bg-light mt-auto">
                    <div class="container-fluid">
                        <div class="d-flex align-items-center justify-content-between small">
                            <div class="text-muted">Copyright &copy; Your Website 2020</div>
                            <div>
                                <a href="#">Privacy Policy</a>
                                &middot;
                                <a href="#">Terms &amp; Conditions</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
         {% endblock %}
        {% block scripts %}
            <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
            <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
            <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>


            <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js" integrity="sha512-rmZcZsyhe0/MAjquhTgiUcb4d9knaFc7b5xAfju483gbEXTkeJRUMIPk6s3ySZMYUHEcjKbjLjyddGWMrNEvZg==" crossorigin="anonymous"></script>
            <script src='https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js'></script>



<script>
        var data = {{ data|safe }}
        let datasets = []
        console.log(data)
        for (let item of data) {
          datasets.push({
                label: item[0],
                borderColor: '#'+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6),
                fill: false,
                data: item[1]
          });
        }
        console.log(datasets)


        var ctx = document.getElementById('snow_sens').getContext('2d');
        var chart = new Chart(ctx, {
          type: 'line',
          data: { datasets: datasets },
          options: {
            scales: {
              xAxes: [{
                type: 'time',
                time: {
                  unit: 'minute'
                }
              }]
            }
          }
        });

</script>


<script>
        var temperature_data = {{ temperature|safe }}
        let temperature_datasets = []
        console.log(temperature_data)
        for (let temp_item of temperature_data) {
          temperature_datasets.push({
                label: temp_item[0],
                borderColor: '#'+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6),
                fill: false,
                data: temp_item[1]
          });
        }
        console.log(temperature_datasets)

        var ctx = document.getElementById('temp_API').getContext('2d');
        var chart = new Chart(ctx, {
          type: 'line',
          data: { datasets: temperature_datasets },
          options: {
            scales: {
              xAxes: [{
                type: 'time',
                time: {
                  unit: 'minute'
                }
              }]
            }
          }
        });


    </script>

            <script>

        var snow_data = {{ snow|safe }}

        var snow = {
          label: 'Показания осадков',
          borderColor: 'blue',
          // backgroundColor:'rgba(255, 99, 132, 0.2)',
          // borderWidth: 1,
          data: snow_data
        };

        var ctx = document.getElementById('snow_API').getContext('2d');
        var chart = new Chart(ctx, {
          // type: 'bar',
          type: 'line',
          data: { datasets: [snow] },
          options: {
            scales: {
              xAxes: [{
                type: 'time',
                time: {
                  unit: 'hour'
                }
              }]
            }
          }
        });

    </script>


<!--<script>-->

<!--        var temperature_data = {{ temperature|safe }}-->

<!--        var temperature = {-->
<!--          label: 'Температура',-->
<!--          borderColor: 'red',-->
<!--          data: temperature_data-->
<!--        };-->

<!--        var ctx = document.getElementById('temp_API').getContext('2d');-->
<!--        var chart = new Chart(ctx, {-->
<!--          type: 'line',-->
<!--          data: { datasets: [temperature] },-->
<!--          options: {-->
<!--            scales: {-->
<!--              xAxes: [{-->
<!--                type: 'time',-->
<!--                time: {-->
<!--                  unit: 'minute'-->
<!--                }-->
<!--              }]-->
<!--            }-->
<!--          }-->
<!--        });-->

<!--    </script>-->


            <script src="{% static 'src/assets/demo/datatables-demo.js' %}"></script>
            <script src="{% static 'src/assets/demo/chart-bar-demo.js' %}"></script>
            <script src="{% static 'src/assets/demo/chart-area-demo.js' %}"></script>
            <script src="{% static 'src/js/scripts.js' %}"></script>
        {% endblock %}



</html>